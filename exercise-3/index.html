
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Deploying Guestbook App Â· Istio at Fast Start</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-web-header/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../exercise-4/" />
    
    
    <link rel="prev" href="../exercise-2/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Workshop setup</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../GETSTARTED.html">
            
                <a href="../GETSTARTED.html">
            
                    
                        <b>2.1.</b>
                    
                    Get Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../exercise-1/">
            
                <a href="../exercise-1/">
            
                    
                        <b>2.2.</b>
                    
                    Access IKS Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../exercise-2/">
            
                <a href="../exercise-2/">
            
                    
                        <b>2.3.</b>
                    
                    Installing Istio
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.4" data-path="./">
            
                <a href="./">
            
                    
                        <b>2.4.</b>
                    
                    Deploying Guestbook App
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Creating a service mesh with Istio</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../exercise-4/">
            
                <a href="../exercise-4/">
            
                    
                        <b>3.1.</b>
                    
                    Metrics and Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../exercise-5/">
            
                <a href="../exercise-5/">
            
                    
                        <b>3.2.</b>
                    
                    Expose with Istio Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../exercise-6/">
            
                <a href="../exercise-6/">
            
                    
                        <b>3.3.</b>
                    
                    Perform traffic management
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Deploying Guestbook App</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="deploy-the-guestbook-app-with-istio-proxy">Deploy the Guestbook app with Istio Proxy</h1>
<p>The Guestbook app is a sample app for users to leave comments. It consists of a web front end, Redis master for storage, and a replicated set of Redis slaves. We will also integrate the app with Watson Tone Analyzer which detects the sentiment in users&apos; comments and replies with emoticons.</p>
<p>     <a href="../README_images/istio1.jpg" rel="grouped" title="" target="_self" class="fancybox">
       <img src="../README_images/istio1.jpg" alt="">
     </a></p>
<h3 id="download-the-guestbook-app">Download the Guestbook app</h3>
<ol>
<li><p>Clone the Guestbook app into the <code>workshop</code> directory.</p>
<pre class="language-"><code class="lang-shell"> git clone https://github.com/IBM/guestbook.git
</code></pre>
</li>
<li><p>Navigate into the app directory.</p>
<pre class="language-"><code class="lang-shell"> cd guestbook/v2
</code></pre>
</li>
</ol>
<h3 id="enable-the-automatic-sidecar-injection-for-the-default-namespace">Enable the automatic sidecar injection for the default namespace</h3>
<p>In Kubernetes, a sidecar is a utility container in the pod, and its purpose is to support the main container. For Istio to work, Envoy proxies must be deployed as sidecars to each pod of the deployment. There are two ways of injecting the Istio sidecar into a pod: manually using the istioctl CLI tool or automatically using the Istio sidecar injector. In this exercise, we will use the automatic sidecar injection provided by Istio.</p>
<ol>
<li><p>Annotate the default namespace to enable automatic sidecar injection:</p>
<pre class="language-"><code class="lang-shell"> kubectl label namespace default istio-injection=enabled
</code></pre>
</li>
<li><p>Validate the namespace is annotated for automatic sidecar injection:</p>
<pre class="language-"><code class="lang-shell"> kubectl get namespace -L istio-injection
</code></pre>
<p> Sample output:</p>
<pre class="language-"><code class="lang-shell"> NAME             STATUS   AGE    ISTIO-INJECTION
 default          Active   271d   enabled
 istio-system     Active   5d2h
 ...
</code></pre>
</li>
</ol>
<h3 id="create-a-redis-database">Create a Redis database</h3>
<p>The Redis database is a service that you can use to persist the data of your app. The Redis database comes with a master and slave modules.</p>
<ol>
<li><p>Create the Redis controllers and services for both the master and the slave.</p>
<pre class="language-"><code class="lang-shell"> kubectl create -f redis-master-deployment.yaml
 kubectl create -f redis-master-service.yaml
 kubectl create -f redis-slave-deployment.yaml
 kubectl create -f redis-slave-service.yaml
</code></pre>
</li>
<li><p>Verify that the Redis controllers for the master and the slave are created.</p>
<pre class="language-"><code class="lang-shell"> kubectl get deployment
</code></pre>
<p> Output:</p>
<pre class="language-"><code class="lang-shell"> NAME           READY   UP-TO-DATE   AVAILABLE   AGE
 redis-master   1/1     1            1           2m16s
 redis-slave    2/2     2            2           2m15s
</code></pre>
</li>
<li><p>Verify that the Redis services for the master and the slave are created.</p>
<pre class="language-"><code class="lang-shell"> kubectl get svc
</code></pre>
<p> Output:</p>
<pre class="language-"><code class="lang-shell"> NAME           TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
 redis-master   ClusterIP      172.21.85.39    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>none</span><span class="token punctuation">&gt;</span></span>          6379/TCP       5d
 redis-slave    ClusterIP      172.21.205.35   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>none</span><span class="token punctuation">&gt;</span></span>          6379/TCP       5d
</code></pre>
</li>
<li><p>Verify that the Redis pods for the master and the slave are up and running.</p>
<pre class="language-"><code class="lang-shell"> kubectl get pods
</code></pre>
<p> Output:</p>
<pre class="language-"><code class="lang-shell"> NAME                            READY     STATUS    RESTARTS   AGE
 redis-master-4sswq              2/2       Running   0          5d
 redis-slave-kj8jp               2/2       Running   0          5d
 redis-slave-nslps               2/2       Running   0          5d
</code></pre>
</li>
</ol>
<h2 id="install-the-guestbook-app">Install the Guestbook app</h2>
<ol>
<li><p>Inject the Istio Envoy sidecar into the guestbook pods, and deploy the Guestbook app on to the Kubernetes cluster. Deploy both the v1 and v2 versions of the app:</p>
<pre class="language-"><code class="lang-shell"> kubectl apply -f ../v1/guestbook-deployment.yaml
 kubectl apply -f guestbook-deployment.yaml
</code></pre>
</li>
</ol>
<p>These commands deploy the Guestbook app on to the Kubernetes cluster. Since we enabled automation sidecar injection, these pods will be also include an Envoy sidecar as they are started in the cluster. Here we have two versions of deployments, a new version (<code>v2</code>) in the current directory, and a previous version (<code>v1</code>) in a sibling directory. They will be used in future sections to showcase the Istio traffic routing capabilities.</p>
<ol>
<li><p>Create the guestbook service.</p>
<pre class="language-"><code class="lang-shell"> kubectl create -f guestbook-service.yaml
</code></pre>
</li>
<li><p>Verify that the service was created.</p>
<pre class="language-"><code class="lang-shell"> kubectl get svc
</code></pre>
<p> Output:</p>
<pre class="language-"><code class="lang-shell"> NAME           TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
 guestbook      LoadBalancer   172.21.36.181   169.61.37.140   80:32149/TCP   5d
 ...
</code></pre>
</li>
<li><p>Verify that the pods are up and running.</p>
<pre class="language-"><code class="lang-shell"> kubectl get pods
</code></pre>
<p> Sample output:</p>
<pre class="language-"><code class="lang-shell"> NAME                            READY   STATUS    RESTARTS   AGE
 guestbook-v1-98dd9c654-dz8dq    2/2     Running   0          30s
 guestbook-v1-98dd9c654-mgfv6    2/2     Running   0          30s
 guestbook-v1-98dd9c654-x8gxx    2/2     Running   0          30s
 guestbook-v2-8689f6c559-5ntgv   2/2     Running   0          28s
 guestbook-v2-8689f6c559-fpzb7   2/2     Running   0          28s
 guestbook-v2-8689f6c559-wqbnl   2/2     Running   0          28s
 redis-master-577bc6fbb-zh5v8    2/2     Running   0          4m47s
 redis-slave-7779c6f75b-bshvs    2/2     Running   0          4m46s
 redis-slave-7779c6f75b-nvsd6    2/2     Running   0          4m46s
</code></pre>
<p> Note that each guestbook pod has 2 containers in it. One is the guestbook container, and the other is the Envoy proxy sidecar.</p>
</li>
</ol>
<h3 id="use-watson-tone-analyzer">Use Watson Tone Analyzer</h3>
<p>Watson Tone Analyzer detects the tone from the words that users enter into the Guestbook app. The tone is converted to the corresponding emoticons.</p>
<p>We&apos;ve created a shared Tone Analyzer service for you to use for this lab. Refer back to the API_KEY and URL given by the &quot;Grant Cluster&quot; app.</p>
<ol>
<li><p>Edit <code>analyzer-deployment.yaml</code> with <code>vi</code>, a similar edtior, or the <code>sed</code> commands below:</p>
<ul>
<li>Replace <code>YOUR_API_KEY</code> with the API key from Grant Cluster</li>
<li>Replace <code>YOUR_URL</code> with <code>https://api.us-south.tone-analyzer.watson.cloud.ibm.com/instances/4cdbea2d-9236-4f58-8a43-1280bfbdfb3f</code></li>
<li><p>Save the file.</p>
<blockquote>
<p>You can do also do this with the sed command:</p>
</blockquote>
<pre class="language-"><code>sed -i &apos;s/YOUR_API_KEY/{replace_with_api_key}/g&apos; analyzer-deployment.yaml
</code></pre><pre class="language-"><code>sed -i &apos;s+YOUR_URL+https://api.us-south.tone-analyzer.watson.cloud.ibm.com/instances/4cdbea2d-9236-4f58-8a43-1280bfbdfb3f+g&apos; analyzer-deployment.yaml
</code></pre></li>
</ul>
</li>
<li><p>Deploy the analyzer pods and service, using the <code>analyzer-deployment.yaml</code> and <code>analyzer-service.yaml</code> files found in the <code>guestbook/v2</code> directory. The analyzer service talks to Watson Tone Analyzer to help analyze the tone of a message.</p>
<pre class="language-"><code class="lang-shell"> kubectl apply -f analyzer-deployment.yaml
 kubectl apply -f analyzer-service.yaml
</code></pre>
</li>
</ol>
<p>Great! Your guestbook app is up and running. In Exercise 4, you&apos;ll be able to see the app in action by directly accessing the service endpoint. You&apos;ll also be able to view Telemetry data for the app.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../exercise-2/" class="navigation navigation-prev " aria-label="Previous page: Installing Istio">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../exercise-4/" class="navigation navigation-next " aria-label="Next page: Metrics and Tracing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Deploying Guestbook App","level":"2.4","depth":1,"next":{"title":"Metrics and Tracing","level":"3.1","depth":1,"path":"exercise-4/README.md","ref":"exercise-4/README.md","articles":[]},"previous":{"title":"Installing Istio","level":"2.3","depth":1,"path":"exercise-2/README.md","ref":"exercise-2/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","collapsible-chapters","hints","copy-code-button","back-to-top-button","fancybox","web-header","codetabs"],"root":"workshop","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"webheader":{"headerTitle":"Istio at Fast Start"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"fancybox":{"helpers":{"buttons":{}},"openEffect":"elastic","closeEffect":"elastic"},"web-header":{},"search":{},"collapsible-chapters":{},"codetabs":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Istio at Fast Start","gitbook":"3.2.3"},"file":{"path":"exercise-3/README.md","mtime":"2020-01-29T11:38:05.920Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-01-29T11:39:10.949Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-web-header/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

