
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Expose with Istio Ingress Â· Istio at Fast Start</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-web-header/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../exercise-6/" />
    
    
    <link rel="prev" href="../exercise-4/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Workshop setup</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../GETSTARTED.html">
            
                <a href="../GETSTARTED.html">
            
                    
                        <b>2.1.</b>
                    
                    Get Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../exercise-1/">
            
                <a href="../exercise-1/">
            
                    
                        <b>2.2.</b>
                    
                    Access IKS Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../exercise-2/">
            
                <a href="../exercise-2/">
            
                    
                        <b>2.3.</b>
                    
                    Installing Istio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../exercise-3/">
            
                <a href="../exercise-3/">
            
                    
                        <b>2.4.</b>
                    
                    Deploying Guestbook App
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Creating a service mesh with Istio</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../exercise-4/">
            
                <a href="../exercise-4/">
            
                    
                        <b>3.1.</b>
                    
                    Metrics and Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.2" data-path="./">
            
                <a href="./">
            
                    
                        <b>3.2.</b>
                    
                    Expose with Istio Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../exercise-6/">
            
                <a href="../exercise-6/">
            
                    
                        <b>3.3.</b>
                    
                    Perform traffic management
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Expose with Istio Ingress</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="expose-the-service-mesh-with-the-istio-ingress-gateway">Expose the service mesh with the Istio Ingress Gateway</h1>
<p>The components deployed on the service mesh by default are not exposed outside the cluster. External access to individual services so far has been provided by creating an external load balancer or node port on each service.</p>
<p>An Ingress Gateway resource can be created to allow external requests through the Istio Ingress Gateway to the backing services.</p>
<p>     <a href="../README_images/istio2.jpg" rel="grouped" title="" target="_self" class="fancybox">
       <img src="../README_images/istio2.jpg" alt="">
     </a></p>
<h3 id="expose-the-guestbook-app-with-ingress-gateway">Expose the Guestbook app with Ingress Gateway</h3>
<ol>
<li>Configure the guestbook default route with the Istio Ingress Gateway. The <code>guestbook-gateway.yaml</code> file is in this repository (istio101) in the <code>workshop/plans</code> directory.</li>
</ol>
<pre class="language-"><code class="lang-shell">cd ../../plans
kubectl create -f guestbook-gateway.yaml
</code></pre>
<ol>
<li>Get the <strong>EXTERNAL-IP</strong> of the Istio Ingress Gateway.</li>
</ol>
<pre class="language-"><code class="lang-shell">kubectl get service istio-ingressgateway -n istio-system
</code></pre>
<p>Output:</p>
<pre class="language-"><code class="lang-shell">NAME                   TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                                       AGE
istio-ingressgateway   LoadBalancer   172.21.254.53    169.6.1.1       80:31380/TCP,443:31390/TCP,31400:31400/TCP    1m
2d
</code></pre>
<ol>
<li>Make note of the external IP address that you retrieved in the previous step, as it will be used to access the Guestbook app in later parts of the course. Create an environment variable called $INGRESS_IP with your IP address.</li>
</ol>
<p>Example:</p>
<pre class="language-"><code>export INGRESS_IP=169.6.1.1
</code></pre><h2 id="connect-istio-ingress-gateway-to-the-ibm-cloud-kubernetes-service-nlb-host-name">Connect Istio Ingress Gateway to the IBM Cloud Kubernetes Service NLB Host Name</h2>
<p>NLB host names are the DNS host names you can generate for each IBM Cloud Kubernetes deployment exposed with the Network LoadBalancer(NLB) service. These host names come with SSL certificate, the DNS registration, and health checks so you can benefit from them for any deployments that you expose via the NLB on IBM Cloud Kubernetes Service.</p>
<p>You can run the IBM Cloud Kubernetes Service ALB, an API gateway of your choice, an Istio ingress gateway, and an MQTT server in parallel in your IBM Cloud Kubernetes Service cluster. Each one will have its own:</p>
<pre class="language-"><code>1. Publicly available wildcard host name
2. Wildcard SSL certificate associated with the host name
3. Health checks that you can configure if you use multizone deployments. 
</code></pre><p>Let&apos;s leverage this feature with Istio ingress gateway:</p>
<ol>
<li><p>Let&apos;s first check if you have any NLB host names for your cluster:</p>
<pre class="language-"><code class="lang-shell"> ibmcloud ks nlb-dnss --cluster $MYCLUSTER
</code></pre>
<p>If you haven&apos;t used this feature before, you will get an empty list.</p>
</li>
<li><p>Obtain the Istio ingress gateway&apos;s external IP. Get the EXTERNAL-IP of the istio-ingressgateway service via output below:</p>
<pre class="language-"><code class="lang-shell"> kubectl get service istio-ingressgateway -n istio-system
</code></pre>
</li>
<li><p>Create the NLB host with the Istio ingress gateway&apos;s public IP address:</p>
<pre class="language-"><code class="lang-shell"> ibmcloud ks nlb-dns-create --cluster $MYCLUSTER --ip $INGRESS_IP
</code></pre>
</li>
<li><p>List the NLB host names for your cluster:</p>
<pre class="language-"><code class="lang-shell"> ibmcloud ks nlb-dnss --cluster $MYCLUSTER
</code></pre>
<p> Example output:</p>
<pre class="language-"><code>Retrieving host names, certificates, IPs, and health check monitors for network load balancer (NLB) pods in cluster <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cluster_name</span><span class="token punctuation">&gt;</span></span>...
 OK
 Hostname                                                                             IP(s)               Health Monitor   SSL Cert Status   SSL Cert Secret Name   
 mycluster-85f044fc29ce613c264409c04a76c95d-0001.us-east.containers.appdomain.cloud   [&quot;169.1.1.1&quot;]   None             created           mycluster-85f044fc29ce613c264409c04a76c95d-0001
</code></pre></li>
<li><p>Make note of the NLB host name (<nlb_host_name>), as it will be used to access your Guestbook app in later parts of the course. Create an environment variable for it and test using curl or visit in your browser.</nlb_host_name></p>
<p> Example:</p>
<pre class="language-"><code> export NLB_HOSTNAME=mycluster-85f044fc29ce613c264409c04a76c95d-0001.us-east.containers.appdomain.cloud
</code></pre><pre class="language-"><code> curl $NLB_HOSTNAME
</code></pre></li>
<li><p>Enable health check of the NLB host for Istio ingress gateway:</p>
<pre class="language-"><code class="lang-shell"> ibmcloud ks nlb-dns-monitor-configure --cluster $MYCLUSTER --nlb-host $NLB_HOSTNAME --type HTTP --description &quot;Istio ingress gateway health check&quot; --path &quot;/healthz/ready&quot; --port 15020 --enable
</code></pre>
</li>
<li><p>Monitor the health check of the NLB host for Istio ingress gateway:</p>
<pre class="language-"><code class="lang-shell"> ibmcloud ks nlb-dns-monitor-status --cluster $MYCLUSTER
</code></pre>
<p> After waiting for a bit, you should start to see the health monitor&apos;s status changed to Enabled.</p>
<p> Example output:</p>
<pre class="language-"><code> Retrieving health check monitor statuses for NLB pods...
 OK
 Hostname                                                                             IP              Health Monitor   H.Monitor Status   
 mycluster-85f044fc29ce613c264409c04a76c95d-0001.us-east.containers.appdomain.cloud   169.1.1.1   Enabled          Healthy
</code></pre></li>
</ol>
<p>Congratulations! You extended the base Ingress features by providing a DNS entry to the Istio service.</p>
<h2 id="references">References:</h2>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank">Kubernetes Ingress</a>
<a href="https://istio.io/docs/tasks/traffic-management/ingress.html" target="_blank">Istio Ingress</a>
<a href="https://www.ibm.com/blogs/bluemix/2019/04/bring-your-own-alb-dns-with-health-checks-and-ssl-certificates-beta/" target="_blank">Bring your own ALB</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../exercise-4/" class="navigation navigation-prev " aria-label="Previous page: Metrics and Tracing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../exercise-6/" class="navigation navigation-next " aria-label="Next page: Perform traffic management">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Expose with Istio Ingress","level":"3.2","depth":1,"next":{"title":"Perform traffic management","level":"3.3","depth":1,"path":"exercise-6/README.md","ref":"exercise-6/README.md","articles":[]},"previous":{"title":"Metrics and Tracing","level":"3.1","depth":1,"path":"exercise-4/README.md","ref":"exercise-4/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","collapsible-chapters","hints","copy-code-button","back-to-top-button","fancybox","web-header","codetabs"],"root":"workshop","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"webheader":{"headerTitle":"Istio at Fast Start"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"fancybox":{"helpers":{"buttons":{}},"openEffect":"elastic","closeEffect":"elastic"},"web-header":{},"search":{},"collapsible-chapters":{},"codetabs":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Istio at Fast Start","gitbook":"3.2.3"},"file":{"path":"exercise-5/README.md","mtime":"2020-01-29T11:32:06.392Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-01-29T11:33:30.072Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-web-header/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

